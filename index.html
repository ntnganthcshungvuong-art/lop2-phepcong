<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>🌸 Bé Na Vui Học 🌸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap');
    body { font-family: 'Baloo 2', sans-serif; }
    .option-btn {
      width: 100%; padding: 14px; border-radius: 16px;
      color:#fff; font-weight:800; font-size:1.15rem;
      margin-bottom: 0.5rem; transition: transform .12s;
    }
    .option-btn:active { transform:scale(1.03); }
    .op-1{background:linear-gradient(135deg,#f59e0b,#fbbf24);}
    .op-2{background:linear-gradient(135deg,#3b82f6,#60a5fa);}
    .op-3{background:linear-gradient(135deg,#10b981,#34d399);}
    .op-4{background:linear-gradient(135deg,#ec4899,#f472b6);}
    .toast {
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:#fff; border:2px solid #fda4af; padding:10px 14px;
      border-radius:14px; color:#9f1239; font-size:15px;
      box-shadow:0 6px 12px rgba(0,0,0,.15);
      animation:fade 2.6s ease forwards; z-index:9999;
    }
    @keyframes fade {
      0%{opacity:0; transform:translate(-50%,12px);}
      12%{opacity:1; transform:translate(-50%,0);}
      88%{opacity:1;}
      100%{opacity:0; transform:translate(-50%,12px);}
    }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-yellow-50 to-blue-100 min-h-screen flex flex-col">

<div class="max-w-4xl mx-auto p-4 flex-grow w-full">
  <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-4 text-purple-700">🌸 Bé Na Vui Học 🌸</h1>

  <!-- HOME -->
  <section id="home" class="space-y-5">
    <div class="grid grid-cols-2 sm:grid-cols-5 gap-3">
      <button class="p-5 rounded-2xl bg-blue-500 text-white font-bold" onclick="start('toan2.json','🔢 Toán 2')">🔢<br/>Toán 2</button>
      <button class="p-5 rounded-2xl bg-green-500 text-white font-bold" onclick="start('tiengviet2.json','📘 Tiếng Việt 2')">📘<br/>Tiếng Việt 2</button>
      <button class="p-5 rounded-2xl bg-amber-500 text-white font-bold" onclick="start('tnxh2.json','🌱 Tự nhiên & Xã hội 2')">🌱<br/>Tự nhiên & Xã hội 2</button>
      <button class="p-5 rounded-2xl bg-rose-500 text-white font-bold" onclick="start('tienganh2.json','🌍 English 2')">🌍<br/>English 2</button>
      <button class="p-5 rounded-2xl bg-violet-500 text-white font-bold" onclick="start('honhop.json','🎲 Hỗn hợp')">🎲<br/>Hỗn hợp</button>
    </div>
  </section>

  <!-- GAME -->
  <section id="game" class="hidden">
    <div class="bg-white rounded-2xl p-4 shadow-md">
      <div class="flex items-center justify-between mb-3">
        <div id="subjectName" class="font-bold text-purple-700">Đang chơi</div>
        <div id="progressText" class="text-sm font-bold text-gray-600">0/0</div>
      </div>
      <div id="qEmoji" class="text-5xl text-center mb-2">🤔</div>
      <h2 id="qText" class="text-xl font-extrabold text-center mb-4">...</h2>
      <div id="optWrap"></div>
      <div class="mt-4 flex justify-between">
        <button onclick="quitToHome()" class="px-4 py-2 bg-gray-400 text-white rounded-xl">🏠 Trang chủ</button>
        <button onclick="skip()" class="px-4 py-2 bg-amber-500 text-white rounded-xl">➡️ Bỏ qua</button>
      </div>
    </div>
  </section>

  <!-- RESULT -->
  <section id="result" class="hidden">
    <div class="bg-white rounded-2xl p-6 text-center shadow-md">
      <div id="resEmoji" class="text-6xl mb-2">🏆</div>
      <h3 id="resTitle" class="text-2xl font-extrabold mb-2">Kết quả</h3>
      <div id="resScore" class="text-xl font-bold text-purple-700">0/10</div>
      <div id="resPercent" class="text-gray-600 mt-1">0%</div>
      <div class="mt-4 flex justify-center gap-3">
        <button onclick="replay()" class="px-5 py-3 bg-green-500 text-white rounded-2xl">🔄 Chơi lại</button>
        <button onclick="quitToHome()" class="px-5 py-3 bg-purple-500 text-white rounded-2xl">🏠 Trang chủ</button>
      </div>
    </div>
  </section>
</div>

<!-- Âm thanh -->
<audio id="sndOk" src="assets/correct.mp3"></audio>
<audio id="sndNo" src="assets/wrong.mp3"></audio>

<script>
let pool=[], bank=[], idx=0, score=0, subjKey="", subjName="";
const sndOk=document.getElementById('sndOk'), sndNo=document.getElementById('sndNo');

function show(id){["home","game","result"].forEach(s=>document.getElementById(s).classList.toggle("hidden",s!==id));}

async function start(file,name){
  subjKey=file; subjName=name;
  const r=await fetch('data/'+file+'?v='+Date.now());
  const data=await r.json();
  pool=shuffle(data);
  bank=pool.splice(0,10);
  idx=0;score=0;
  document.getElementById('subjectName').textContent="Đang chơi: "+name;
  show("game"); render();
}

function render(){
  const q=bank[idx];
  document.getElementById('progressText').textContent=`Câu ${idx+1}/${bank.length}`;
  document.getElementById('qEmoji').textContent=q.emoji||"❓";
  document.getElementById('qText').textContent=q.q;
  const wrap=document.getElementById('optWrap');
  wrap.innerHTML="";
  (q.options||[]).forEach((opt,i)=>{
    const btn=document.createElement('button');
    btn.className=`option-btn ${['op-1','op-2','op-3','op-4'][i%4]}`;
    btn.textContent=opt;
    btn.onclick=()=>choose(i,q);
    wrap.appendChild(btn);
  });
}

function choose(i,q){
  const ok=i===q.answer;
  if(ok){score++;play(sndOk);} else {play(sndNo);toast("Đáp án đúng: "+q.options[q.answer]);}
  idx++; setTimeout(next,1000);
}

function skip(){
  const q=bank[idx];
  play(sndNo); toast("Đáp án đúng: "+q.options[q.answer]);
  idx++; setTimeout(next,1000);
}

function next(){
  if(idx<bank.length){render();return;}
  if(pool.length>=10){ bank=pool.splice(0,10); idx=0; render(); return; }
  endGame();
}

function endGame(){
  const percent=Math.round(score/(bank.length||1)*100);
  show("result");
  document.getElementById('resScore').textContent=`${score}/${bank.length}`;
  document.getElementById('resPercent').textContent=percent+"%";
  document.getElementById('resTitle').textContent=percent>=90?"Xuất sắc!":percent>=70?"Tốt lắm!":percent>=50?"Khá tốt!":"Cố gắng hơn nhé!";
  document.getElementById('resEmoji').textContent=percent>=90?"🏆":percent>=70?"🌟":percent>=50?"👍":"💪";
}

function replay(){idx=0;score=0;show("game");render();}
function quitToHome(){show("home");}

function play(a){a.currentTime=0;a.play().catch(()=>{});}
function toast(msg){
  const t=document.createElement('div');
  t.className='toast'; t.innerHTML=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2600);
}
function shuffle(arr){return arr.map(x=>({x,r:Math.random()})).sort((a,b)=>a.r-b.r).map(o=>o.x);}
</script>
</body>
</html>
